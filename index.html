<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FORTNITE SKIN BATTLE: ¬°DERROTA A LA IA!</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Oxanium:wght@600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Oxanium', sans-serif;
      color: white;
      text-align: center;
      margin: 0;
      padding: 10px;
      background: #0a0a1a;
      position: relative;
      overflow-x: hidden;
      min-height: 100vh;
    }
    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: radial-gradient(ellipse at center, #1a1a2e 0%, #0a0a1a 70%);
      z-index: -3;
    }
    .particles { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
    .particle { position: absolute; border-radius: 50%; animation: float 15s infinite linear; }
    @keyframes float { to { transform: translate(var(--tx), var(--ty)) rotate(360deg); opacity: 0; } }

    .content { position: relative; z-index: 10; opacity: 0; animation: fadeIn 1.5s forwards; }
    @keyframes fadeIn { to { opacity: 1; } }

    /* Barra de trofeos y diamantes */
    .trophy-bar {
      background: rgba(10,10,26,0.7);
      padding: 12px;
      border-radius: 12px;
      margin: 15px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 1.2em;
      border: 2px solid gold;
    }
    .trophy-info, .diamonds-info {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .league-badge {
      padding: 4px 12px;
      border-radius: 20px;
      font-weight: bold;
      font-size: 0.95em;
    }
    .league-bronze { background: linear-gradient(to right, #cd7f32, #b8860b); }
    .league-silver { background: linear-gradient(to right, silver, #c0c0c0); color: #333; }
    .league-gold { background: linear-gradient(to right, gold, #daa520); }
    .league-elite { background: linear-gradient(to right, #4b0082, #8a2be2); }
    .league-legend { background: linear-gradient(45deg, red, gold, blue); animation: rainbow 3s linear infinite; }

    /* Pesta√±as */
    .nav-buttons {
      margin: 15px 0;
    }
    .nav-btn {
      background: rgba(78,205,196,0.2);
      color: white;
      border: 1px solid #4ecdc4;
      padding: 10px 18px;
      margin: 0 5px;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: bold;
    }
    .nav-btn.active {
      background: #4ecdc4;
      color: #0a0a1a;
    }

    /* Tienda */
    .store-section {
      margin: 20px auto;
      max-width: 500px;
      background: rgba(10,10,26,0.5);
      padding: 15px;
      border-radius: 15px;
      border: 1px solid #ff6b6b;
    }
    .store-items {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
      margin-top: 15px;
    }
    .store-item {
      background: rgba(25,25,45,0.8);
      padding: 10px;
      border-radius: 10px;
      border-left: 4px solid;
    }
    .store-item.gold { border-left-color: gold; }
    .store-item.orange { border-left-color: #ff6b35; }
    .store-item.purple { border-left-color: #a29bfe; }

    /* Mesa de batalla */
    .battle-table {
      display: none;
      margin: 20px auto;
      max-width: 700px;
      background: rgba(5, 5, 15, 0.9);
      border: 3px solid gold;
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 0 30px rgba(255,215,0,0.5);
      position: relative;
      overflow: hidden;
    }
    .battle-table::after {
      content: '';
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      background: radial-gradient(circle, transparent 60%, rgba(0,0,0,0.7) 100%);
      pointer-events: none;
    }

    /* Efectos de ataque */
    .attack-overlay {
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none;
      z-index: 10;
      opacity: 0;
    }
    .fire-effect { background: radial-gradient(circle, rgba(255,90,0,0.6) 0%, transparent 70%); animation: fireBurst 1s forwards; }
    .ice-effect { background: radial-gradient(circle, rgba(0,200,255,0.5) 0%, transparent 70%); animation: iceShatter 1s forwards; }
    .wind-effect { background: radial-gradient(circle, rgba(100,255,200,0.4) 0%, transparent 70%); animation: windSwirl 1s forwards; }
    .arcane-effect { background: radial-gradient(circle, rgba(200,100,255,0.6) 0%, transparent 70%); animation: arcanePulse 1s forwards; }

    @keyframes fireBurst { 0% { opacity: 0.8; transform: scale(0.5); } 100% { opacity: 0; transform: scale(2); } }
    @keyframes iceShatter { 0% { opacity: 0.9; transform: scale(0.3); } 50% { opacity: 0.9; } 100% { opacity: 0; transform: scale(1.5); } }
    @keyframes windSwirl { 0% { opacity: 0.7; transform: rotate(0) scale(0.5); } 100% { opacity: 0; transform: rotate(180deg) scale(2); } }
    @keyframes arcanePulse { 
      0% { opacity: 0.9; transform: scale(0.4); box-shadow: 0 0 10px #c864ff; } 
      50% { box-shadow: 0 0 20px #ff64c8, 0 0 30px #64c8ff; } 
      100% { opacity: 0; transform: scale(1.8); } 
    }

    .battle-header {
      margin-bottom: 25px;
      font-size: 1.4em;
      color: #4ecdc4;
      text-shadow: 0 0 10px rgba(78,205,196,0.7);
    }

    .battle-zone {
      display: flex;
      justify-content: space-between;
      margin: 30px 0;
    }
    .player-zone, .enemy-zone {
      width: 48%;
      text-align: center;
    }
    .zone-title {
      margin-bottom: 15px;
      font-weight: bold;
    }
    .player-zone .zone-title { color: #4ecdc4; }
    .enemy-zone .zone-title { color: #ff6b6b; }

    .battle-card {
      position: relative;
      width: 160px;
      margin: 0 auto;
    }
    .card-image {
      width: 100%;
      border-radius: 12px;
      border: 3px solid #333;
      box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    }
    .card-rarity {
      position: absolute;
      top: 8px;
      right: 8px;
      font-size: 0.8em;
      font-weight: bold;
      padding: 4px 8px;
      border-radius: 10px;
      background: rgba(0,0,0,0.6);
    }
    .common { color: white; }
    .rare { color: #ff6b35; }
    .epic { color: #a29bfe; }
    .legendary { 
      color: transparent;
      background: linear-gradient(45deg, red, gold, blue, purple);
      -webkit-background-clip: text;
      background-clip: text;
      animation: rainbow 3s linear infinite;
    }

    .hp-bar {
      width: 100%;
      height: 12px;
      background: #333;
      border-radius: 6px;
      margin-top: 8px;
      overflow: hidden;
    }
    .hp-fill {
      height: 100%;
      background: linear-gradient(to right, #ff416c, #ff4b2b);
      width: 100%;
      transition: width 0.5s ease;
    }
    .hp-text {
      font-size: 0.9em;
      margin-top: 4px;
      color: #feca57;
    }

    .hand {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    .hand-card {
      background: rgba(20,20,40,0.9);
      border-radius: 12px;
      padding: 10px;
      width: 120px;
      cursor: pointer;
      transition: transform 0.2s;
      border: 2px solid #45b7d1;
    }
    .hand-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 8px 20px rgba(78,205,196,0.6);
    }
    .hand-card img {
      width: 100%;
      border-radius: 8px;
    }

    .battle-log {
      background: rgba(0,0,0,0.6);
      padding: 15px;
      border-radius: 12px;
      margin: 20px 0;
      min-height: 80px;
      font-size: 1.15em;
      color: #feca57;
      border: 1px solid #4ecdc4;
    }
    .action-btn {
      background: #4ecdc4;
      color: #0a0a1a;
      border: none;
      padding: 12px 25px;
      font-size: 1.15em;
      font-weight: bold;
      border-radius: 50px;
      cursor: pointer;
      margin: 10px 5px;
      transition: all 0.3s;
      box-shadow: 0 4px 10px rgba(0,0,0,0.4);
    }
    .action-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 15px rgba(0,0,0,0.5);
    }

    .main-menu {
      text-align: center;
    }
    .menu-btn {
      background: #ff6b6b;
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 1.3em;
      font-weight: bold;
      border-radius: 50px;
      cursor: pointer;
      margin: 20px 10px;
      transition: all 0.3s;
      box-shadow: 0 5px 15px rgba(255,107,107,0.4);
    }
    .menu-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 20px rgba(255,107,107,0.6);
    }

    .collection-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
      gap: 12px;
      margin: 20px auto;
      max-width: 600px;
    }
    .collection-card {
      background: rgba(20,20,40,0.8);
      border-radius: 10px;
      padding: 8px;
      position: relative;
      opacity: 0.6;
      cursor: not-allowed;
    }
    .collection-card.unlocked {
      opacity: 1;
      cursor: pointer;
    }
    .collection-card.locked::after {
      content: "üîí";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 1.8em;
      color: #ff6b6b;
    }
    .collection-card img {
      width: 100%;
      border-radius: 6px;
      border: 2px solid #333;
    }

    .deck-section {
      background: rgba(10,10,26,0.6);
      padding: 15px;
      border-radius: 12px;
      margin: 20px 0;
      border: 1px solid #4ecdc4;
    }

    .coming-soon {
      margin: 30px auto;
      max-width: 500px;
      background: rgba(0,0,0,0.4);
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      border: 2px dashed gold;
    }
    .coming-soon h3 {
      color: gold;
      font-family: 'Bebas Neue';
    }

    /* Vista detallada de carta */
    .card-preview {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      background: rgba(10,10,26,0.95);
      padding: 20px;
      border-radius: 15px;
      max-width: 300px;
      z-index: 2000;
      border: 3px solid gold;
      box-shadow: 0 0 30px gold;
      opacity: 0;
      transition: all 0.3s ease;
    }
    .card-preview.show {
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
    }
    .card-preview img {
      width: 100%;
      border-radius: 10px;
      margin-bottom: 12px;
    }
    .rarity-tag {
      padding: 4px 12px;
      border-radius: 20px;
      font-weight: bold;
      display: inline-block;
      margin: 5px 0;
    }
    .rarity-common-tag { background: rgba(255,255,255,0.2); color: white; }
    .rarity-rare-tag { background: rgba(255,107,53,0.3); color: #ff6b35; }
    .rarity-epic-tag { background: rgba(162,155,254,0.3); color: #a29bfe; }
    .rarity-legendary-tag { 
      background: linear-gradient(45deg, red, gold, blue);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-fill-color: transparent;
      font-weight: bold;
    }

    @keyframes rainbow { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }

    @media (max-width: 600px) {
      .battle-card { width: 130px; }
      .hand-card { width: 100px; }
      .battle-table, .store-section, .collection-grid { padding: 15px; }
      .nav-btn { padding: 8px 14px; font-size: 0.95em; }
      .card-preview { width: 90%; padding: 15px; }
    }
  </style>
</head>
<body>
  <div class="particles" id="particles"></div>
  <div class="content">
    <h1>FORTNITE SKIN BATTLE: ¬°DERROTA A LA IA!</h1>
    
    <!-- ‚úÖ BARRA DE TROFEOS Y DIAMANTES -->
    <div class="trophy-bar">
      <div class="trophy-info">
        <span class="trophy-icon">üèÜ</span>
        <span id="trophyCount">0</span> trofeos
      </div>
      <div class="league-badge" id="leagueBadge">Bronce</div>
      <div class="diamonds-info">
        <span>üíé</span>
        <span id="diamondCount">100</span> diamantes
      </div>
    </div>

    <!-- Pesta√±as -->
    <div class="nav-buttons">
      <button class="nav-btn active" onclick="showView('battle')">‚öîÔ∏è Batalla</button>
      <button class="nav-btn" onclick="showView('collection')">üÉè Mazo</button>
      <button class="nav-btn" onclick="showView('store')">üõí Tienda</button>
    </div>

    <!-- üíé TIENDA -->
    <div class="store-section" id="storeView" style="display:none;">
      <h3 style="color:gold; font-family:'Bebas Neue'">üõí TIENDA DE BATALLA</h3>
      <div class="store-items">
        <div class="store-item gold">
          <div style="font-weight:bold;">Skin Dorada</div>
          <div class="power">+30 DEF</div>
          <div style="color:gold; font-weight:bold;">50 üíé</div>
          <button class="action-btn" onclick="buyItem('golden_skin',50)" style="font-size:0.85em; padding:4px 8px; margin-top:5px;">Comprar</button>
        </div>
        <div class="store-item purple">
          <div style="font-weight:bold;">Confeti √âpico</div>
          <div class="power">Ataque Sorpresa</div>
          <div style="color:gold; font-weight:bold;">30 üíé</div>
          <button class="action-btn" onclick="buyItem('epic_confetti',30)" style="font-size:0.85em; padding:4px 8px; margin-top:5px;">Comprar</button>
        </div>
        <div class="store-item orange">
          <div style="font-weight:bold;">Doble Voto</div>
          <div class="power">Doble Ataque</div>
          <div style="color:gold; font-weight:bold;">70 üíé</div>
          <button class="action-btn" onclick="buyItem('double_vote',70)" style="font-size:0.85em; padding:4px 8px; margin-top:5px;">Comprar</button>
        </div>
      </div>
      <p id="storeMessage" style="margin-top:10px; color:#4ecdc4; font-style:italic;"></p>
    </div>

    <!-- ‚öîÔ∏è BATALLA -->
    <div class="main-menu" id="battleView">
      <button class="menu-btn" onclick="startBattle()">‚öîÔ∏è ¬°INICIAR BATALLA CONTRA LA IA!</button>
      <p style="color:#4ecdc4; margin-top:20px;">Usa las cartas de tu mazo para derrotar a la IA.</p>
    </div>

    <!-- üÉè MAZO -->
    <div class="collection" id="collectionView" style="display:none;">
      <h2 style="color: #4ecdc4;">Mi Mazo (3 cartas)</h2>
      <p>Selecciona cartas desbloqueadas para tu mazo.</p>
      <div class="collection-grid" id="collectionGrid">
      </div>
      
      <div class="deck-section">
        <h3>Tu Mazo Actual</h3>
        <div id="currentDeck" style="display:flex; justify-content:center; flex-wrap:wrap; gap:10px;"></div>
        <button class="action-btn" onclick="saveDeck()" style="margin-top:10px;">üíæ Guardar Mazo</button>
      </div>
    </div>

    <!-- Mesa de batalla -->
    <div class="battle-table" id="battleTable">
      <div class="battle-header">BATALLA CONTRA LA IA - Arena: <span id="arenaName">Bronce</span></div>
      
      <div class="battle-zone">
        <div class="enemy-zone">
          <div class="zone-title">IA</div>
          <div class="battle-card">
            <img id="enemyCardImg" class="card-image" src="" alt="IA">
            <div class="card-rarity" id="enemyRarity"></div>
            <div class="hp-bar">
              <div class="hp-fill" id="enemyHpBar"></div>
            </div>
            <div class="hp-text">HP: <span id="enemyHp">0</span></div>
          </div>
        </div>
        
        <div class="player-zone">
          <div class="zone-title">T√ö</div>
          <div class="battle-card">
            <img id="playerCardImg" class="card-image" src="" alt="Jugador">
            <div class="card-rarity" id="playerRarity"></div>
            <div class="hp-bar">
              <div class="hp-fill" id="playerHpBar"></div>
            </div>
            <div class="hp-text">HP: <span id="playerHp">0</span></div>
          </div>
        </div>
      </div>

      <div class="attack-overlay" id="attackOverlay"></div>

      <div class="battle-log" id="battleLog">
        ¬°Elige una carta de tu mazo para atacar!
      </div>

      <div class="hand" id="playerHand">
      </div>

      <button class="action-btn" onclick="exitBattle()" style="background:#ff6b6b;">üö™ Salir</button>
    </div>

    <!-- üîú Actualizaci√≥n -->
    <div class="coming-soon">
      <h3>üîî ¬°PR√ìXIMA ACTUALIZACI√ìN! üîî</h3>
      <p><strong>Ma√±ana: ¬°Modo Multijugador!</strong></p>
      <p>Juega contra amigos en tiempo real.</p>
    </div>
  </div>

  <!-- Vista detallada de carta -->
  <div class="card-preview" id="cardPreview">
    <img id="previewImg" src="" alt="">
    <h3 id="previewName"></h3>
    <div id="previewRarity" class="rarity-tag"></div>
    <div id="previewStats"></div>
    <div id="previewPower" style="color:gold; font-style:italic;"></div>
  </div>

  <!-- Sonidos -->
  <audio id="fireSound" src="https://assets.mixkit.co/sfx/preview/mixkit-fire-magic-arcade-explosion-2445.mp3" preload="auto"></audio>
  <audio id="iceSound" src="https://assets.mixkit.co/sfx/preview/mixkit-ice-impact-2446.mp3" preload="auto"></audio>
  <audio id="windSound" src="https://assets.mixkit.co/sfx/preview/mixkit-whoosh-air-whoosh-2447.mp3" preload="auto"></audio>
  <audio id="arcaneSound" src="https://assets.mixkit.co/sfx/preview/mixkit-magic-arcade-whoosh-2448.mp3" preload="auto"></audio>
  <audio id="hitSound" src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3" preload="auto"></audio>
  <audio id="loseSound" src="https://assets.mixkit.co/sfx/preview/mixkit-retro-arcade-lose-2027.mp3" preload="auto"></audio>
  <audio id="winSound" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" preload="auto"></audio>

  <script>
    const CARDS = [
      { id:0, name:"Ram√≠rez", img:"https://s93.erome.com/5472/K3IRZbxx/Y8DPmT76.jpeg?v=1764825894", rarity:"common", atk:60, def:50, power:"Paso Firme", attackType:"wind", unlocked: true },
      { id:1, name:"Azulita", img:"https://s93.erome.com/5472/K3IRZbxx/0B8OzReu.jpeg?v=1764815871", rarity:"rare", atk:70, def:55, power:"Confeti √Åcido", attackType:"fire", unlocked: true },
      { id:2, name:"Tormenta", img:"https://s93.erome.com/5472/K3IRZbxx/7GmdJa3U.jpeg?v=1764802552", rarity:"epic", atk:80, def:45, power:"Torbellino", attackType:"wind", unlocked: false },
      { id:3, name:"Fortaleza", img:"https://s93.erome.com/5472/K3IRZbxx/1FvcJ5u7.png?v=1764809177", rarity:"rare", atk:60, def:70, power:"Muralla", attackType:"ice", unlocked: true },
      { id:4, name:"Danza", img:"https://s93.erome.com/5472/K3IRZbxx/0VxSvgAl.jpeg?v=1764818017", rarity:"epic", atk:75, def:50, power:"Baile √âpico", attackType:"wind", unlocked: false },
      { id:5, name:"Furia", img:"https://s93.erome.com/5472/K3IRZbxx/LsMURibY.jpeg?v=1764812622", rarity:"legendary", atk:90, def:40, power:"Ira Incontenible", attackType:"fire", unlocked: false },
      { id:6, name:"Escudera", img:"https://s93.erome.com/5472/K3IRZbxx/9RweIpam.jpeg?v=1764813677", rarity:"common", atk:55, def:65, power:"Protecci√≥n", attackType:"ice", unlocked: true },
      { id:7, name:"Asesina", img:"https://s206.erome.com/4699/lpRzYjBO/Z5Tc5k2v.jpeg?v=1745795818", rarity:"legendary", atk:95, def:30, power:"Golpe Letal", attackType:"fire", unlocked: false },
      { id:8, name:"Guardiana", img:"https://s206.erome.com/4699/lpRzYjBO/P9p2wv5y.jpeg?v=1745795818", rarity:"epic", atk:50, def:80, power:"Escudo Energ√©tico", attackType:"ice", unlocked: false },
      { id:9, name:"IA √âLITE", img:"https://s206.erome.com/4699/lpRzYjBO/gU2HfmRY.jpeg?v=1745795818", rarity:"legendary", atk:100, def:35, power:"Tirano", attackType:"arcane", unlocked: true }
    ];

    const LEAGUES = [
      { name: "Bronce", min: 0, max: 199, badgeClass: "league-bronze", iaMod: -20 },
      { name: "Plata", min: 200, max: 399, badgeClass: "league-silver", iaMod: 0 },
      { name: "Oro", min: 400, max: 599, badgeClass: "league-gold", iaMod: 20 },
      { name: "√âlite", min: 600, max: 799, badgeClass: "league-elite", iaMod: 40 },
      { name: "Leyenda", min: 800, max: Infinity, badgeClass: "league-legend", iaMod: 60 }
    ];

    let currentDeck = JSON.parse(localStorage.getItem('currentDeck')) || [0, 3, 6];
    let playerCards = [];
    let enemyCard = null;
    let gameActive = true;
    let playerTurn = true;
    let selectedPlayerCard = null;
    let trophies = parseInt(localStorage.getItem('trophies')) || 0;
    let diamonds = 100; // Cr√©ditos diarios
    let currentLeague = LEAGUES[0];

    // Cargar diamantes
    const today = new Date().toDateString();
    const lastDiamondClaim = localStorage.getItem('lastDiamondClaim');
    if (lastDiamondClaim !== today) {
      localStorage.setItem('diamonds', 100);
      localStorage.setItem('lastDiamondClaim', today);
    }
    diamonds = parseInt(localStorage.getItem('diamonds')) || 100;

    const savedCards = JSON.parse(localStorage.getItem('cards')) || {};
    CARDS.forEach(card => {
      if (savedCards[card.id] !== undefined) {
        card.unlocked = savedCards[card.id];
      }
    });

    function saveCollection() {
      const state = {};
      CARDS.forEach(card => state[card.id] = card.unlocked);
      localStorage.setItem('cards', JSON.stringify(state));
    }

    function updateUI() {
      // Trofeos
      localStorage.setItem('trophies', trophies);
      document.getElementById('trophyCount').innerText = trophies;
      
      // Liga
      const newLeague = LEAGUES.find(l => trophies >= l.min && trophies <= l.max) || LEAGUES[0];
      if (newLeague.name !== currentLeague.name) {
        currentLeague = newLeague;
        showNotification(`¬°Ascendiste a ${newLeague.name}! üéâ`);
      }
      document.getElementById('leagueBadge').className = `league-badge ${newLeague.badgeClass}`;
      document.getElementById('leagueBadge').innerText = newLeague.name;
      document.getElementById('arenaName').innerText = newLeague.name;

      // Diamantes
      localStorage.setItem('diamonds', diamonds);
      document.getElementById('diamondCount').innerText = diamonds;
    }

    function showNotification(msg) {
      const notif = document.createElement('div');
      notif.innerText = msg;
      notif.style.position = 'fixed';
      notif.style.top = '20%';
      notif.style.left = '50%';
      notif.style.transform = 'translateX(-50%)';
      notif.style.background = 'gold';
      notif.style.color = '#0a0a1a';
      notif.style.padding = '10px 20px';
      notif.style.borderRadius = '10px';
      notif.style.fontWeight = 'bold';
      notif.style.zIndex = '1000';
      notif.style.fontSize = '1.2em';
      document.body.appendChild(notif);
      setTimeout(() => document.body.removeChild(notif), 3000);
    }

    function buyItem(id, cost) {
      if (diamonds >= cost) {
        diamonds -= cost;
        localStorage.setItem(`owned_${id}`, 'true');
        updateUI();
        document.getElementById('storeMessage').innerText = '¬°Compra exitosa! üéâ';
        setTimeout(() => document.getElementById('storeMessage').innerText = '', 3000);
      } else {
        document.getElementById('storeMessage').innerText = '‚ùå Diamantes insuficientes.';
        setTimeout(() => document.getElementById('storeMessage').innerText = '', 3000);
      }
    }

    function showView(view) {
      document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      
      document.getElementById('battleView').style.display = view === 'battle' ? 'block' : 'none';
      document.getElementById('collectionView').style.display = view === 'collection' ? 'block' : 'none';
      document.getElementById('storeView').style.display = view === 'store' ? 'block' : 'none';
      document.getElementById('battleTable').style.display = 'none';
    }

    function showCardPreview(card) {
      document.getElementById('previewImg').src = card.img;
      document.getElementById('previewName').innerText = card.name;
      
      const rarityColors = {
        common: "rarity-common-tag",
        rare: "rarity-rare-tag",
        epic: "rarity-epic-tag",
        legendary: "rarity-legendary-tag"
      };
      const rarityNames = {
        common: "Com√∫n",
        rare: "Rara",
        epic: "√âpica",
        legendary: "Legendaria"
      };
      
      const rarityEl = document.getElementById('previewRarity');
      rarityEl.className = `rarity-tag ${rarityColors[card.rarity]}`;
      rarityEl.innerText = rarityNames[card.rarity];
      
      document.getElementById('previewStats').innerText = `ATK: ${card.atk} | DEF: ${card.def}`;
      document.getElementById('previewPower').innerText = card.power;
      
      document.getElementById('cardPreview').classList.add('show');
    }

    document.getElementById('cardPreview').onclick = () => {
      document.getElementById('cardPreview').classList.remove('show');
    };

    function renderCollection() {
      const grid = document.getElementById('collectionGrid');
      grid.innerHTML = '';
      // Excluir la carta de IA (√∫ltima)
      CARDS.slice(0, -1).forEach(card => {
        const div = document.createElement('div');
        div.className = `collection-card ${card.unlocked ? 'unlocked' : 'locked'}`;
        if (card.unlocked) {
          const img = document.createElement('img');
          img.src = card.img;
          img.alt = card.name;
          div.appendChild(img);
          div.onclick = () => showCardPreview(card);
        }
        grid.appendChild(div);
      });

      // Renderizar mazo actual
      const deckEl = document.getElementById('currentDeck');
      deckEl.innerHTML = '';
      currentDeck.forEach(id => {
        const card = CARDS.find(c => c.id === id && c.unlocked);
        if (card) {
          const cardEl = document.createElement('div');
          cardEl.style.width = '100px';
          cardEl.style.margin = '5px';
          cardEl.innerHTML = `<img src="${card.img}" style="width:100%; border-radius:8px;" onclick="showCardPreview(${JSON.stringify(card).replace(/"/g, '&quot;')})">`;
          deckEl.appendChild(cardEl);
        }
      });
    }

    function addToDeck(cardId) {
      if (currentDeck.length >= 3) {
        alert('Tu mazo solo puede tener 3 cartas.');
        return;
      }
      if (!currentDeck.includes(cardId)) {
        currentDeck.push(cardId);
        renderCollection();
      }
    }

    function saveDeck() {
      if (currentDeck.length !== 3) {
        alert('¬°Tu mazo debe tener exactamente 3 cartas!');
        return;
      }
      localStorage.setItem('currentDeck', JSON.stringify(currentDeck));
      showNotification('¬°Mazo guardado!');
    }

    function playAttackEffect(type) {
      const overlay = document.getElementById('attackOverlay');
      overlay.className = 'attack-overlay';
      overlay.classList.add(`${type}-effect`);
      overlay.style.opacity = '1';
      
      const soundMap = {
        fire: 'fireSound',
        ice: 'iceSound',
        wind: 'windSound',
        arcane: 'arcaneSound'
      };
      const sound = document.getElementById(soundMap[type]);
      if (sound) sound.play().catch(()=>{});
      
      setTimeout(() => {
        overlay.style.opacity = '0';
      }, 1000);
    }

    function startBattle() {
      // Cargar mazo guardado
      const savedDeck = JSON.parse(localStorage.getItem('currentDeck')) || [0, 3, 6];
      currentDeck = savedDeck;
      
      playerCards = [];
      currentDeck.forEach(id => {
        const card = CARDS.find(c => c.id === id && c.unlocked);
        if (card) {
          playerCards.push({...card, currentHp: card.def, alive: true});
        }
      });

      if (playerCards.length === 0) {
        alert('¬°Tu mazo est√° vac√≠o! Ve a "Mazo" y arma tu mazo.');
        return;
      }

      // Carta de IA (siempre la misma)
      const iaCard = {...CARDS[9], currentHp: CARDS[9].def, alive: true};
      enemyCard = iaCard;

      gameActive = true;
      playerTurn = true;
      selectedPlayerCard = null;

      document.getElementById('battleView').style.display = 'none';
      document.getElementById('battleTable').style.display = 'block';
      
      updateBattleUI();
    }

    function updateBattleUI() {
      // Enemigo
      document.getElementById('enemyCardImg').src = enemyCard.img;
      document.getElementById('enemyRarity').innerText = enemyCard.rarity;
      document.getElementById('enemyRarity').className = `card-rarity ${enemyCard.rarity}`;
      document.getElementById('enemyHp').innerText = enemyCard.currentHp;
      document.getElementById('enemyHpBar').style.width = `${(enemyCard.currentHp / enemyCard.def) * 100}%`;
      
      // Jugador
      if (selectedPlayerCard) {
        document.getElementById('playerCardImg').src = selectedPlayerCard.img;
        document.getElementById('playerRarity').innerText = selectedPlayerCard.rarity;
        document.getElementById('playerRarity').className = `card-rarity ${selectedPlayerCard.rarity}`;
        document.getElementById('playerHp').innerText = selectedPlayerCard.currentHp;
        document.getElementById('playerHpBar').style.width = `${(selectedPlayerCard.currentHp / selectedPlayerCard.def) * 100}%`;
      }

      // Mano
      const handEl = document.getElementById('playerHand');
      handEl.innerHTML = '';
      playerCards.forEach(card => {
        if (card.alive) {
          const cardEl = document.createElement('div');
          cardEl.className = 'hand-card';
          cardEl.innerHTML = `
            <img src="${card.img}" alt="${card.name}">
            <div style="font-size:0.9em; margin-top:5px;">${card.name}</div>
          `;
          cardEl.onclick = () => {
            selectedPlayerCard = card;
            attackWithSelected();
          };
          handEl.appendChild(cardEl);
        }
      });
    }

    function attackWithSelected() {
      if (!gameActive || !playerTurn || !selectedPlayerCard) return;
      
      const log = document.getElementById('battleLog');
      log.innerHTML = `¬°${selectedPlayerCard.name} usa <strong>${selectedPlayerCard.power}</strong>!`;

      playAttackEffect(selectedPlayerCard.attackType);

      const damage = Math.max(5, selectedPlayerCard.atk - Math.floor(enemyCard.def * 0.3));
      setTimeout(() => {
        enemyCard.currentHp = Math.max(0, enemyCard.currentHp - damage);
        updateBattleUI();

        if (enemyCard.currentHp <= 0) {
          log.innerHTML = `¬°${selectedPlayerCard.name} derrot√≥ a la IA!`;
          setTimeout(() => {
            const oldTrophies = trophies;
            trophies += 30;
            updateUI();
            const msg = `¬°Ganaste 30 trofeos!<br>Total: ${trophies} trofeos.`;
            showEndScreen(true, msg);
          }, 1500);
        } else {
          log.innerHTML += `<br>¬°Turno de la IA!`;
          setTimeout(() => iaAttack(), 1500);
        }
        playerTurn = false;
      }, 1000);
    }

    function iaAttack() {
      if (!gameActive || !selectedPlayerCard) return;
      
      const log = document.getElementById('battleLog');
      log.innerHTML = `¬°La IA ataca a ${selectedPlayerCard.name}!`;

      playAttackEffect(enemyCard.attackType);

      const baseDamage = Math.max(5, enemyCard.atk - Math.floor(selectedPlayerCard.def * 0.3));
      const modifier = currentLeague.iaMod / 100;
      const damage = Math.round(baseDamage * (1 + modifier));

      setTimeout(() => {
        selectedPlayerCard.currentHp = Math.max(0, selectedPlayerCard.currentHp - damage);
        updateBattleUI();

        if (selectedPlayerCard.currentHp <= 0) {
          selectedPlayerCard.alive = false;
          log.innerHTML = `¬°${selectedPlayerCard.name} fue eliminada!`;
          
          const aliveCards = playerCards.filter(c => c.alive);
          if (aliveCards.length === 0) {
            const oldTrophies = trophies;
            trophies = Math.max(0, trophies - 15);
            updateUI();
            const msg = `Perdiste 15 trofeos.<br>Total: ${trophies} trofeos.`;
            showEndScreen(false, msg);
            return;
          }
          selectedPlayerCard = aliveCards[0];
        }

        playerTurn = true;
        log.innerHTML = `¬°Tu turno! Elige una carta para atacar:`;
      }, 1000);
    }

    function showEndScreen(isWin, message) {
      gameActive = false;
      const log = document.getElementById('battleLog');
      log.innerHTML = `
        <h3 style="color:${isWin ? 'gold' : '#ff6b6b'};">
          ${isWin ? 'üéâ ¬°VICTORIA!' : 'üíÄ DERROTA'}
        </h3>
        <p style="margin:15px 0;">${message}</p>
        <button class="action-btn" onclick="startBattle()" style="margin-top:15px;">üîÑ Otra Partida</button>
      `;
      document.getElementById(isWin ? 'winSound' : 'loseSound').play();
    }

    function exitBattle() {
      document.getElementById('battleTable').style.display = 'none';
      document.getElementById('battleView').style.display = 'block';
      showNotification(`Trofeos: ${trophies} | Diamantes: ${diamonds}`);
    }

    // Iniciar
    createParticles();
    updateUI();
    renderCollection(); // Asegurar que el mazo se renderice

    function createParticles() {
      const c = document.getElementById('particles');
      const n = 15;
      for (let i = 0; i < n; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        const s = Math.random() * 4 + 1;
        p.style.width = p.style.height = `${s}px`;
        p.style.left = `${Math.random() * 100}%`;
        p.style.top = `${Math.random() * 100}%`;
        const cols = ['rgba(255,107,107,0.7)','rgba(78,205,196,0.7)','rgba(254,202,87,0.7)'];
        p.style.background = cols[Math.floor(Math.random() * cols.length)];
        p.style.setProperty('--tx', `${(Math.random()-0.5)*200}px`);
        p.style.setProperty('--ty', `${(Math.random()-0.5)*200}px`);
        p.style.animationDuration = `${15 + Math.random() * 20}s`;
        c.appendChild(p);
      }
    }
  </script>
</body>
</html>
