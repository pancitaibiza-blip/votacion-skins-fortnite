<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèÜ Fortnite Cartas - Ultimate Tournament</title>
    
    <!-- Librer√≠as Externas -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <!-- Import Map (Crucial para Gemini en navegador) -->
    <script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.34.0",
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>

    <style>
        body {
            background-color: #020202;
            color: white;
            font-family: 'Inter', system-ui, sans-serif;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }

        /* Animaciones de Batalla */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-6px) rotate(-1deg); }
            75% { transform: translateX(6px) rotate(1deg); }
        }
        .animate-shake { animation: shake 0.15s ease-in-out infinite; }

        @keyframes jump-attack {
            0% { transform: translateY(0); }
            50% { transform: translateY(-50px) scale(1.1); filter: brightness(1.3); }
            100% { transform: translateY(0); }
        }
        .animate-attack { animation: jump-attack 0.4s cubic-bezier(.36,.07,.19,.97); }

        @keyframes float-dmg {
            0% { opacity: 0; transform: translateY(0); }
            20% { opacity: 1; }
            100% { opacity: 0; transform: translateY(-80px) scale(1.5); }
        }
        .dmg-popup {
            position: absolute;
            font-weight: 900;
            pointer-events: none;
            z-index: 100;
            animation: float-dmg 0.8s forwards;
            text-shadow: 0 0 10px rgba(0,0,0,0.9);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- EL TRUCO: data-type="module" permite usar 'import' dentro de Babel -->
    <script type="text/babel" data-type="module">
        const { useState, useEffect, useCallback, useRef } = React;
        import { GoogleGenAI } from "@google/genai";

        // Configuraci√≥n
        const firebaseConfig = {
            apiKey: "AIzaSyAgYrcmcSzz2umxAUp5UqCL3pgNKKR08lU",
            authDomain: "juego-de-cartas-f7284.firebaseapp.com",
            databaseURL: "https://juego-de-cartas-f7284-default-rtdb.firebaseio.com",
            projectId: "juego-de-cartas-f7284"
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Datos
        const CARDS = [
            { id: 0, name: "Ram√≠rez", rarity: "common", baseAtk: 60, baseDef: 50, img: "https://s93.erome.com/5472/K3IRZbxx/Y8DPmT76.jpeg?v=1764825894", shopPrice: 50 },
            { id: 1, name: "Fortaleza", rarity: "rare", baseAtk: 60, baseDef: 70, img: "https://s93.erome.com/5472/K3IRZbxx/1FvcJ5u7.png?v=1764809177", shopPrice: 100 },
            { id: 4, name: "Tormenta", rarity: "epic", baseAtk: 80, baseDef: 45, img: "https://s93.erome.com/5472/K3IRZbxx/7GmdJa3U.jpeg?v=1764802552", shopPrice: 120 },
            { id: 5, name: "Furia", rarity: "legendary", baseAtk: 90, baseDef: 40, img: "https://s93.erome.com/5472/K3IRZbxx/LsMURibY.jpeg?v=1764812622", shopPrice: 200 },
            { id: 21, name: "Sabrina Diva", rarity: "idolos", baseAtk: 120, baseDef: 80, img: "https://i.pinimg.com/736x/4d/c9/b3/4dc9b3acdf2ab04c3c783d3fb2730a0c.jpg", shopPrice: 2000 },
            { id: 50, name: "Busting Out", rarity: "animated", baseAtk: 5000, baseDef: 2500, img: "https://cdn2.hentaigifz.com/115480/busting-the-fuck-out-scaled.webp", shopPrice: 5000 },
            { id: 101, name: "Wet Handjob", rarity: "actricesporno", baseAtk: 12000, baseDef: 6000, img: "https://s2.pictoa.com/media/galleries/269/410/269410603155505d89c/393371260315552a7156.gif", shopPrice: 7000 }
        ];

        const TOURNAMENT_ENEMIES = [
            { phase: 1, name: "Timmy Novato", atk: 40, hp: 100, reward: 100, avatar: "https://cdn-icons-png.flaticon.com/512/1077/1077114.png" },
            { phase: 2, name: "Soldado Dave", atk: 70, hp: 180, reward: 300, avatar: "https://cdn-icons-png.flaticon.com/512/1077/1077114.png" },
            { phase: 3, name: "REY SHADOW", atk: 180, hp: 600, reward: 5000, avatar: "https://cdn-icons-png.flaticon.com/512/1077/1077114.png" }
        ];

        const RARITY_CLASS = {
            common: 'border-slate-400', rare: 'border-green-500', epic: 'border-purple-500', 
            legendary: 'border-orange-500', idolos: 'border-pink-500', 
            animated: 'border-amber-400', actricesporno: 'border-red-600'
        };

        const App = () => {
            const [view, setView] = useState('news');
            const [diamonds, setDiamonds] = useState(1000);
            const [owned, setOwned] = useState([0, 1]);
            const [deck, setDeck] = useState([0]);
            const [userName, setUserName] = useState('');
            const [userAvatar, setUserAvatar] = useState(CARDS[0].img);
            const [loading, setLoading] = useState(true);

            // Batalla
            const [tournamentPhase, setTournamentPhase] = useState(0);
            const [enemyHp, setEnemyHp] = useState(100);
            const [playerHp, setPlayerHp] = useState(100);
            const [isAttacking, setIsAttacking] = useState(false);
            const [attackerIdx, setAttackerIdx] = useState(null);
            const [enemyHit, setEnemyHit] = useState(false);
            const [dmgPopups, setDmgPopups] = useState([]);
            const [battleResult, setBattleResult] = useState(null);

            useEffect(() => {
                let user = localStorage.getItem('ft_user') || prompt("Tu nombre:") || "Player";
                localStorage.setItem('ft_user', user);
                setUserName(user);
                db.ref('users/' + user).once('value', (s) => {
                    const d = s.val();
                    if(d) { setDiamonds(d.diamonds); setOwned(d.owned); setDeck(d.deck); setUserAvatar(d.avatar); }
                    setLoading(false);
                });
            }, []);

            const sync = (upd) => db.ref('users/' + userName).update(upd);

            const attack = async () => {
                if (isAttacking || battleResult) return;
                setIsAttacking(true);
                const idx = Math.floor(Math.random() * deck.length);
                const card = CARDS.find(c => c.id === deck[idx]);
                setAttackerIdx(idx);
                
                await new Promise(r => setTimeout(r, 200));
                const dmg = Math.floor(card.baseAtk / 5 + Math.random() * 10);
                const nEHp = Math.max(0, enemyHp - dmg);
                setEnemyHp(nEHp);
                setEnemyHit(true);
                setDmgPopups(p => [...p, { id: Date.now(), val: dmg, x: 50, y: 30, color: 'text-red-500' }]);
                
                await new Promise(r => setTimeout(r, 400));
                setEnemyHit(false); setAttackerIdx(null);
                if(nEHp <= 0) {
                    const rew = TOURNAMENT_ENEMIES[tournamentPhase-1].reward;
                    setDiamonds(d => d + rew); sync({ diamonds: diamonds + rew });
                    setBattleResult({ win: true, msg: `¬°GANASTE! +${rew} üíé` });
                } else {
                    // Contraataque enemigo simplificado
                    const eDmg = Math.floor(TOURNAMENT_ENEMIES[tournamentPhase-1].atk / 5);
                    setPlayerHp(h => Math.max(0, h - eDmg));
                    setDmgPopups(p => [...p, { id: Date.now()+1, val: eDmg, x: 50, y: 70, color: 'text-cyan-400' }]);
                    if(playerHp - eDmg <= 0) setBattleResult({ win: false, msg: "DERROTA" });
                }
                setIsAttacking(false);
            };

            if (loading) return <div className="h-screen flex items-center justify-center bg-black font-black">CARGANDO...</div>;

            return (
                <div className="max-w-md mx-auto min-h-screen pb-24 bg-black flex flex-col shadow-2xl">
                    <header className="p-4 bg-zinc-900/90 border-b border-zinc-800 flex justify-between items-center sticky top-0 z-50">
                        <div className="flex items-center gap-3">
                            <img src={userAvatar} className="w-10 h-10 rounded-full border-2 border-cyan-500 object-cover" />
                            <span className="font-black text-xs uppercase tracking-tighter">{userName}</span>
                        </div>
                        <div className="text-amber-500 font-black text-xs italic">üíé {diamonds.toLocaleString()}</div>
                    </header>

                    <main className="flex-1 p-4 overflow-y-auto custom-scrollbar">
                        {view === 'news' && (
                            <div className="bg-zinc-900 border border-zinc-800 p-10 rounded-[2.5rem] text-center space-y-6">
                                <h2 className="text-2xl font-black italic uppercase">Base de Operaciones</h2>
                                <button onClick={() => { setDiamonds(d => d + 5000); alert("¬°Bono!"); }} className="w-full bg-cyan-600 py-4 rounded-3xl font-black text-xs">üéÅ RECOGER 5,000 GEMAS</button>
                            </div>
                        )}

                        {view === 'tournament' && (
                            <div className="h-full flex flex-col space-y-4">
                                {tournamentPhase === 0 ? (
                                    <div className="flex-1 flex flex-col items-center justify-center bg-zinc-900/50 rounded-[3rem] p-10 text-center space-y-6 border border-zinc-800">
                                        <div className="text-6xl">üèÜ</div>
                                        <h2 className="text-xl font-black italic text-amber-500 uppercase">Arena de Combate</h2>
                                        <button onClick={() => { setTournamentPhase(1); setEnemyHp(100); setPlayerHp(100); setBattleResult(null); }} className="w-full bg-amber-600 py-4 rounded-3xl font-black text-xs text-black">ENTRAR A LUCHAR</button>
                                    </div>
                                ) : (
                                    <div className="space-y-4 relative flex flex-col h-full min-h-[500px]">
                                        {/* Boss */}
                                        <div className={`bg-zinc-900 p-4 rounded-3xl border border-zinc-800 flex justify-between items-center ${enemyHit ? 'animate-shake' : ''}`}>
                                            <img src={TOURNAMENT_ENEMIES[tournamentPhase-1].avatar} className="w-12 h-12 rounded-lg border-2 border-red-500" />
                                            <div className="flex-1 px-4 text-right">
                                                <div className="text-[10px] font-black">{enemyHp} HP</div>
                                                <div className="h-1.5 bg-black rounded-full overflow-hidden mt-1">
                                                    <div className="h-full bg-red-600 transition-all" style={{ width: `${(enemyHp/TOURNAMENT_ENEMIES[tournamentPhase-1].hp)*100}%` }} />
                                                </div>
                                            </div>
                                        </div>

                                        {/* Arena */}
                                        <div className="flex-1 relative flex items-center justify-center">
                                            {dmgPopups.map(p => (
                                                <div key={p.id} className={`dmg-popup ${p.color} text-4xl`} style={{ left: `${p.x}%`, top: `${p.y}%` }}>-{p.val}</div>
                                            ))}
                                            <div className="opacity-10 font-black italic text-6xl italic select-none">VERSUS</div>
                                        </div>

                                        {/* Player */}
                                        <div className="bg-zinc-900 p-4 rounded-3xl border border-zinc-800 space-y-4">
                                            <div className="flex justify-center gap-2 items-end h-24">
                                                {deck.map((id, i) => (
                                                    <img key={i} src={CARDS.find(c => c.id === id).img} className={`w-14 h-20 rounded-lg border-2 ${attackerIdx === i ? 'animate-attack border-cyan-400' : 'border-zinc-800'}`} />
                                                ))}
                                            </div>
                                            {!battleResult ? (
                                                <button onClick={attack} disabled={isAttacking} className="w-full bg-cyan-600 py-4 rounded-2xl font-black text-xs">üí• ATACAR</button>
                                            ) : (
                                                <div className="text-center space-y-3">
                                                    <div className={`text-xl font-black ${battleResult.win ? 'text-green-500' : 'text-red-500'}`}>{battleResult.msg}</div>
                                                    <button onClick={() => setTournamentPhase(0)} className="w-full bg-zinc-800 py-3 rounded-xl font-black text-[10px]">SALIR</button>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {view === 'shop' && (
                            <div className="grid grid-cols-2 gap-3 pb-4">
                                {CARDS.filter(c => !owned.includes(c.id)).map(card => (
                                    <div key={card.id} className={`bg-zinc-900 border-2 rounded-2xl p-2 ${RARITY_CLASS[card.rarity]}`}>
                                        <img src={card.img} className="aspect-[3/4] object-cover rounded-xl mb-2" />
                                        <button onClick={() => {
                                            if(diamonds >= card.shopPrice) {
                                                const nO = [...owned, card.id];
                                                setOwned(nO); setDiamonds(d => d - card.shopPrice);
                                                sync({ owned: nO, diamonds: diamonds - card.shopPrice });
                                            } else alert("Faltan gemas");
                                        }} className="w-full bg-green-600 py-2 rounded-lg font-black text-[10px]">üíé {card.shopPrice}</button>
                                    </div>
                                ))}
                            </div>
                        )}

                        {view === 'deck' && (
                            <div className="space-y-6">
                                <h3 className="text-[10px] font-black text-zinc-500 px-2 uppercase tracking-widest italic">Mazo ({deck.length}/3)</h3>
                                <div className="grid grid-cols-3 gap-3 bg-zinc-900/30 border-2 border-dashed border-zinc-800 p-4 rounded-3xl min-h-[140px]">
                                    {deck.map(id => (
                                        <div key={id} onClick={() => { const n = deck.filter(x => x !== id); setDeck(n); sync({ deck: n }); }} className="relative">
                                            <img src={CARDS.find(c => c.id === id).img} className="rounded-xl border-2 border-red-500/50 grayscale hover:grayscale-0 transition-all cursor-pointer" />
                                            <div className="absolute top-0 right-0 bg-red-600 rounded-full w-4 h-4 text-[8px] flex items-center justify-center font-bold">‚úï</div>
                                        </div>
                                    ))}
                                </div>
                                <h3 className="text-[10px] font-black text-zinc-500 px-2 uppercase tracking-widest italic">Colecci√≥n</h3>
                                <div className="grid grid-cols-3 gap-3">
                                    {owned.map(id => {
                                        const c = CARDS.find(x => x.id === id);
                                        const isIn = deck.includes(id);
                                        return (
                                            <div key={id} onClick={() => { if(!isIn && deck.length < 3) { const n = [...deck, id]; setDeck(n); sync({ deck: n }); } }} className={`relative cursor-pointer transition-all ${isIn ? 'opacity-30' : 'hover:scale-105'}`}>
                                                <img src={c.img} className={`rounded-xl border-2 ${RARITY_CLASS[c.rarity]}`} />
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        )}
                    </main>

                    <nav className="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-zinc-950/95 border-t border-zinc-800 py-6 flex justify-around items-center rounded-t-[2.5rem] backdrop-blur-xl px-2">
                        <NavBtn act={view === 'news'} onClick={() => setView('news')} ico="üè†" />
                        <NavBtn act={view === 'tournament'} onClick={() => setView('tournament')} ico="üèÜ" />
                        <NavBtn act={view === 'shop'} onClick={() => setView('shop')} ico="üõí" />
                        <NavBtn act={view === 'deck'} onClick={() => setView('deck')} ico="üÉè" />
                    </nav>
                </div>
            );
        };

        const NavBtn = ({ act, onClick, ico }) => (
            <button onClick={onClick} className={`w-12 h-12 rounded-2xl flex items-center justify-center text-xl transition-all ${act ? 'bg-cyan-600 shadow-[0_0_15px_rgba(6,182,212,0.4)] scale-110' : 'bg-zinc-900 opacity-30 hover:opacity-100'}`}>
                {ico}
            </button>
        );

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
