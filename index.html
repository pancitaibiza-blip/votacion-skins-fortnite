<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>üéÑ Fortnite Cartas - Evento Navide√±o</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <style>
        body {
            background: linear-gradient(135deg, #b22222, #228b22, #ffd700, #ffffff);
            background-size: 400% 400%;
            animation: gradientBG 30s ease infinite;
            color: white;
            min-height: 100vh;
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            overflow-x: hidden;
            position: relative;
        }
        body::before {
            content: "üéÑ";
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 24px;
            opacity: 0.7;
            z-index: 1;
        }
        body::after {
            content: "‚ùÑÔ∏è";
            position: absolute;
            bottom: 20px;
            right: 20px;
            font-size: 28px;
            opacity: 0.6;
            z-index: 1;
        }
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .snowflake {
            position: absolute;
            background: white;
            border-radius: 50%;
            pointer-events: none;
            animation: fall linear infinite;
            z-index: 0;
        }
        @keyframes fall {
            0% { top: -10vh; transform: translateX(0) rotate(0deg); }
            100% { top: 110vh; transform: translateX(0) rotate(360deg); }
        }
        .btn {
            background: linear-gradient(to right, #d42020, #ff4545);
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 4px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(255, 200, 200, 0.8);
        }
        .chest-container {
            position: relative;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .chest-container:hover {
            transform: scale(1.1);
        }
        .chest {
            width: 200px;
            height: 200px;
            background-size: cover;
            border-radius: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            text-shadow: 0 2px 4px black;
        }
        .chest-rare { background: linear-gradient(#4caf50, #2e7d32), url('https://via.placeholder.com/200?text=Cofre+Raro'); }
        .chest-epic { background: linear-gradient(#9c27b0, #6a1b9a), url('https://via.placeholder.com/200?text=Cofre+√âpico'); }
        .chest-legendary { background: linear-gradient(#ff9800, #e65100), url('https://via.placeholder.com/200?text=Cofre+Legendario'); }
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 16px;
            justify-content: center;
            margin-top: 20px;
        }
        .chests-grid {
            display: flex;
            justify-content: center;
            gap: 40px;
            flex-wrap: wrap;
            margin: 40px 0;
        }
        #collectionCounter {
            text-align: center;
            font-size: 22px;
            font-weight: bold;
            margin: 15px 0;
            padding: 12px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 12px;
            text-shadow: 0 1px 3px rgba(0,0,0,0.8);
        }
        /* Resto del CSS igual que antes */
    </style>
</head>
<body>
    <div id="offerBanner">
        üéÅ ¬°OFERTA POR TIEMPO LIMITADO! üíé ¬°1000 GEMAS POR SOLO HOY!
        <span id="gemsCountdown">--h --m --s</span>
    </div>
    <div id="announcementBanner">
        ¬°NUEVA ACTUALIZACI√ìN! YA EST√ÅN DISPONIBLES LOS COFRES EN LA TIENDA üéÅ
    </div>
    <div class="container mx-auto px-4 py-6 pt-24">
        <div class="text-center mb-6">
            <img id="profileAvatar" src="https://rule34.xxx//samples/1888/sample_4387d777c732825ae6e377664c2ce885.jpg?15738037" alt="Avatar" class="w-20 h-20 rounded-full mx-auto border-4 border-red-500 shadow-lg">
            <h2 class="text-2xl font-bold mt-3" id="playerName">Jugador</h2>
        </div>
        <div class="stats-bar">
            <div class="stat"><i class="fas fa-trophy trophy"></i> <span id="trophies">0</span></div>
            <div class="stat"><i class="fas fa-gem gem"></i> <span id="diamonds">100</span></div>
            <div class="stat"><i class="fas fa-crown crown"></i> <span id="cups">0</span></div>
        </div>
        <h1 class="text-4xl font-bold text-center mb-8 text-transparent bg-clip-text bg-gradient-to-r from-red-500 to-green-500">üéÑ FORTNITE: BATALLA NAVIDE√ëA</h1>

        <!-- BATALLA, MAZO, RANKING, COPAS, LOGROS... (igual que antes) -->

        <div id="shop" class="section-container">
            <h2 class="text-3xl font-bold text-center mb-6 text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">üíé TIENDA NAVIDE√ëA</h2>
            <div id="gemsOffer" class="bg-gradient-to-r from-blue-600 to-purple-600 p-6 rounded-2xl text-center mb-8 mx-auto max-w-3xl animate-pulse shadow-xl">
                <h3 class="text-2xl font-bold text-yellow-300">üî• ¬°OFERTA √öNICA! üî•</h3>
                <p class="text-xl">¬°1000 GEMAS por tiempo limitado!</p>
                <p class="text-md text-yellow-200">Oferta termina en: <span id="shopGemsCountdown">--h --m --s</span></p>
                <button class="btn bg-yellow-500 text-black mt-4" onclick="buyGemsPackage()">Comprar por $4.99</button>
            </div>

            <!-- NUEVO: SECCI√ìN DE COFRES -->
            <h3 class="text-3xl font-bold text-center mb-6 text-yellow-300">üéÅ COFRES DISPONIBLES</h3>
            <div class="chests-grid">
                <div class="chest-container" onclick="openChest('rare')">
                    <div class="chest chest-rare">üì¶</div>
                    <p class="text-center mt-4 text-xl font-bold">Cofre Raro<br><span class="text-yellow-300">150 gemas</span><br><small>3-5 cartas (comunes/raras)</small></p>
                </div>
                <div class="chest-container" onclick="openChest('epic')">
                    <div class="chest chest-epic">üì¶</div>
                    <p class="text-center mt-4 text-xl font-bold">Cofre √âpico<br><span class="text-yellow-300">400 gemas</span><br><small>4-6 cartas (raras/√©picas)</small></p>
                </div>
                <div class="chest-container" onclick="openChest('legendary')">
                    <div class="chest chest-legendary">üì¶</div>
                    <p class="text-center mt-4 text-xl font-bold">Cofre Legendario<br><span class="text-yellow-300">800 gemas</span><br><small>5-8 cartas (√©picas/legendarias)</small></p>
                </div>
            </div>

            <div class="card-grid" id="shopCards"></div>
        </div>

        <!-- Resto de secciones (tournament, ranking, etc.) igual que antes -->

    </div>

    <script>
        // ... (todo el script anterior igual, con ALL_CARDS, TOURNAMENTS, funciones de batalla, etc.)

        // NUEVA FUNCI√ìN PARA ABRIR COFRES
        function openChest(type) {
            let price = 0;
            let minCards = 0, maxCards = 0;
            let pool = [];

            if (type === 'rare') {
                price = 150;
                minCards = 3; maxCards = 5;
                pool = ALL_CARDS.filter(c => ['common', 'rare'].includes(c.rarity));
            } else if (type === 'epic') {
                price = 400;
                minCards = 4; maxCards = 6;
                pool = ALL_CARDS.filter(c => ['rare', 'epic'].includes(c.rarity));
            } else if (type === 'legendary') {
                price = 800;
                minCards = 5; maxCards = 8;
                pool = ALL_CARDS.filter(c => ['epic', 'legendary', 'idolos', 'tournament', 'paises'].includes(c.rarity));
            }

            if (gameState.diamonds < price) {
                alert("¬°Gemas insuficientes para abrir este cofre!");
                return;
            }

            if (!confirm(`¬øAbrir Cofre ${type.charAt(0).toUpperCase() + type.slice(1)} por ${price} gemas?`)) return;

            gameState.diamonds -= price;
            const numCards = Math.floor(Math.random() * (maxCards - minCards + 1)) + minCards;
            const wonCards = [];
            for (let i = 0; i < numCards; i++) {
                const card = pool[Math.floor(Math.random() * pool.length)];
                if (!gameState.ownedCardIds.includes(card.id)) {
                    gameState.ownedCardIds.push(card.id);
                }
                wonCards.push(card);
            }

            saveGame();
            updateUI();
            renderDeck();
            renderShop();

            let message = `¬°Cofre ${type.charAt(0).toUpperCase() + type.slice(1)} abierto!\nHas obtenido:\n`;
            wonCards.forEach(c => message += `- ${c.name} (${c.rarity})\n`);
            alert(message);
            wonCards.forEach(card => showNewCard(card));
        }

        // ... (resto del script igual)

        updateUI();
        showView('battle');
        createSnowflakes();
        checkAchievements();
    </script>
</body>
</html>
