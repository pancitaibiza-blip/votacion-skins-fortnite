<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>üéÆ Fortnite TCG - REPLAY SYSTEM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Montserrat', sans-serif; background: radial-gradient(circle at center, #1a2a3a 0%, #050505 100%); color: white; min-height: 100vh; overflow-x: hidden; }
        .glass-panel { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 1rem; }
        .view { display: none; }
        .view.active { display: block; animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .nav-btn { color: rgba(255,255,255,0.4); transition: 0.3s; cursor: pointer; text-align: center; }
        .nav-btn.active { color: white; transform: scale(1.1); }
        .card-vertical { aspect-ratio: 2 / 3; width: 100%; position: relative; overflow: hidden; border-radius: 0.5rem; }
        .rarity-common { border: 2px solid #94a3b8; } .rarity-rare { border: 2px solid #22c55e; }
        .rarity-epic { border: 2px solid #a855f7; } .rarity-legendary { border: 2px solid #f97316; }
        .rarity-idolos { border: 2px solid #ec4899; } .rarity-paises { border: 2px solid #3b82f6; }
        .rarity-tournament { border: 2px solid #6366f1; box-shadow: 0 0 10px #6366f1; }
        .rarity-animated { border: 2px solid #fbbf24; box-shadow: 0 0 15px #fbbf2455; }
        .rarity-actricesporno { border: 2px solid #ef4444; box-shadow: 0 0 20px #ef444477; }
        #reveal-overlay { display: none; position: fixed; inset: 0; z-index: 1000; background: rgba(0,0,0,0.85); backdrop-filter: blur(10px); align-items: center; justify-content: center; pointer-events: none; }
        #reveal-overlay.active { display: flex; animation: revealPop 1.5s ease-in-out forwards; }
        @keyframes revealPop { 0% { transform: scale(0); opacity: 0; } 20% { transform: scale(1); opacity: 1; } 80% { transform: scale(1); opacity: 1; } 100% { transform: scale(1.2); opacity: 0; } }
    </style>
</head>
<body class="pb-24">

    <div id="reveal-overlay">
        <div class="text-center">
            <h2 id="reveal-title" class="text-xl font-black italic uppercase text-yellow-400 mb-4"></h2>
            <div class="w-60 aspect-[2/3] glass-panel p-2 mx-auto"><img id="reveal-img" src="" class="w-full h-full object-cover rounded-xl"></div>
        </div>
    </div>

    <div class="container mx-auto px-4 pt-10">
        <div class="flex items-center gap-4 mb-6">
            <img id="u-avatar" src="" class="w-14 h-14 rounded-full border-2 border-white object-cover">
            <div>
                <div class="flex items-center gap-1"><span id="u-clan" class="text-cyan-400 font-black text-[9px] hidden"></span><h2 id="u-name" class="font-black italic text-xs uppercase">CARGANDO...</h2></div>
                <div class="text-[10px] font-bold mt-1">üíé <span id="v-diamonds" class="text-cyan-400">0</span> | üèÜ <span id="v-trophies" class="text-yellow-400">0</span></div>
            </div>
        </div>

        <section id="view-news" class="view active"><div id="news-container" class="space-y-4"></div></section>

        <section id="view-battle" class="view">
            <div id="battle-lobby" class="glass-panel p-6 text-center max-w-sm mx-auto space-y-4">
                <h3 class="font-black text-sm uppercase italic">Campo de Batalla</h3>
                <input id="room-id-input" type="text" placeholder="ID SALA" class="w-full bg-black/50 p-3 rounded-lg border border-white/10 text-center uppercase font-black">
                <button onclick="multiplayer.join()" class="w-full py-3 bg-cyan-600 rounded-lg font-black italic">BUSCAR RIVAL ‚öîÔ∏è</button>
                <button onclick="multiplayer.join('', false, true)" class="w-full py-3 bg-white/10 rounded-lg font-black italic text-[10px]">ENTRENAR VS BOT ü§ñ</button>
            </div>
            <div id="battle-arena" class="hidden space-y-4">
                <div class="glass-panel p-4 border-2 border-red-500/20">
                    <div class="flex items-center gap-3">
                        <img id="rival-avatar" src="" class="w-10 h-10 rounded-full object-cover bg-black">
                        <div class="flex-1 text-[9px] font-black"><span id="rival-name">RIVAL</span> - <span id="rival-hp">100 HP</span>
                        <div class="w-full bg-black h-1.5 rounded-full overflow-hidden mt-1"><div id="rival-hp-bar" class="h-full bg-red-600 w-full transition-all duration-500"></div></div></div>
                    </div>
                </div>
                <div id="battle-status" class="text-center font-black text-cyan-400 uppercase italic text-[10px] h-4"></div>
                <div class="glass-panel p-4 border-2 border-cyan-500/20"><div id="player-battle-deck" class="grid grid-cols-3 gap-2"></div></div>
            </div>
        </section>

        <section id="view-clans" class="view">
            <div class="glass-panel p-4 mb-4"><div id="clans-list" class="space-y-2"></div><button onclick="clans.showCreate()" class="w-full mt-2 py-2 bg-white/10 rounded font-black text-[9px]">NUEVO CLAN</button></div>
            <div class="glass-panel p-4 flex flex-col h-80">
                <div id="clan-chat-box" class="flex-1 overflow-y-auto space-y-2 mb-4 text-[10px] pr-2"></div>
                <div class="flex gap-2"><input id="clan-msg-input" type="text" placeholder="Escribir..." class="flex-1 bg-black/40 p-2 rounded text-white text-xs"><button onclick="clans.sendMsg()" class="w-10 bg-cyan-600 rounded"><i class="fas fa-paper-plane"></i></button></div>
            </div>
        </section>

        <section id="view-deck" class="view"><div id="deck-grid" class="grid grid-cols-2 sm:grid-cols-4 gap-4"></div></section>
        <section id="view-shop" class="view"><div class="text-center mb-4"><button onclick="shop.claimMegaGift()" class="px-6 py-2 bg-yellow-400 text-black font-black rounded-lg text-[9px] uppercase">1M GEMAS GRATIS</button></div><div id="shop-items" class="grid grid-cols-2 sm:grid-cols-5 gap-4"></div></section>
    </div>

    <nav class="fixed bottom-0 inset-x-0 h-16 bg-black/95 border-t border-white/10 flex items-center justify-around z-50">
        <button onclick="router.navigate('news')" class="nav-btn flex-1"><i class="fas fa-home text-sm"></i><div class="text-[7px] font-black uppercase">Home</div></button>
        <button onclick="router.navigate('battle')" class="nav-btn flex-1"><i class="fas fa-swords text-sm"></i><div class="text-[7px] font-black uppercase">Duelo</div></button>
        <button onclick="router.navigate('clans')" class="nav-btn flex-1"><i class="fas fa-shield-alt text-sm"></i><div class="text-[7px] font-black uppercase">Clan</div></button>
        <button onclick="router.navigate('deck')" class="nav-btn flex-1"><i class="fas fa-layer-group text-sm"></i><div class="text-[7px] font-black uppercase">Mazo</div></button>
        <button onclick="router.navigate('shop')" class="nav-btn flex-1"><i class="fas fa-shopping-bag text-sm"></i><div class="text-[7px] font-black uppercase">Shop</div></button>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, update, get, push } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        const fbConfig = { apiKey: "AIzaSyAgYrcmcSzz2umxAUp5UqCL3pgNKKR08lU", authDomain: "juego-de-cartas-f7284.firebaseapp.com", projectId: "juego-de-cartas-f7284", databaseURL: "https://juego-de-cartas-f7284-default-rtdb.firebaseio.com" };
        const app = initializeApp(fbConfig); const db = getDatabase(app);

        const ALL_CARDS = [
            { id: 0, name: "Ram√≠rez", rarity: "common", baseAtk: 60, img: "https://s93.erome.com/5472/K3IRZbxx/Y8DPmT76.jpeg?v=1764825894", shopPrice: 50 },
            { id: 1, name: "Fortaleza", rarity: "rare", baseAtk: 60, img: "https://s93.erome.com/5472/K3IRZbxx/1FvcJ5u7.png?v=1764809177", shopPrice: 100 },
            { id: 2, name: "Escudera", rarity: "common", baseAtk: 55, img: "https://s93.erome.com/5472/K3IRZbxx/9RweIpam.jpeg?v=1764813677", shopPrice: 50 },
            { id: 3, name: "Azulita", rarity: "rare", baseAtk: 70, img: "https://s93.erome.com/5472/K3IRZbxx/0B8OzReu.jpeg?v=1764815871", shopPrice: 80 },
            { id: 4, name: "Tormenta", rarity: "epic", baseAtk: 80, img: "https://s93.erome.com/5472/K3IRZbxx/7GmdJa3U.jpeg?v=1764802552", shopPrice: 120 },
            { id: 5, name: "Furia", rarity: "legendary", baseAtk: 90, img: "https://s93.erome.com/5472/K3IRZbxx/LsMURibY.jpeg?v=1764812622", shopPrice: 200 },
            { id: 6, name: "Asesina", rarity: "legendary", baseAtk: 95, img: "https://s206.erome.com/4699/lpRzYjBO/Z5Tc5k2v.jpeg?v=1745795818", shopPrice: 250 },
            { id: 7, name: "Francine Smith", rarity: "legendary", baseAtk: 110, img: "https://wimg.rule34.xxx//images/1888/0334e8239c387a302348c01810815aef.jpeg?15738062", shopPrice: 1000 },
            { id: 11, name: "Campe√≥n Sombra", rarity: "tournament", baseAtk: 140, img: "https://s100.erome.com/2418/B2TgruwR/61zc8Veb.png?v=1712563892", shopPrice: null },
            { id: 12, name: "Maestro del Fuego", rarity: "tournament", baseAtk: 150, img: "https://s326.erome.com/5139/YBnb1NTO/pN2evqNZ.jpeg?v=1750357395", shopPrice: null },
            { id: 13, name: "Rey del Hielo", rarity: "tournament", baseAtk: 135, img: "https://s10.erome.com/6694/EUAdAxk1/1zdVPLQh.jpeg?v=1764732026", shopPrice: null },
            { id: 14, name: "Felina", rarity: "epic", baseAtk: 85, img: "https://rule34.xxx//samples/2288/sample_ce3c07d28a9fdd2475d6fc67df8ff4e4.jpg?15302020", shopPrice: 300 },
            { id: 16, name: "Serenade", rarity: "epic", baseAtk: 85, img: "https://rule34.xxx//samples/3001/sample_59915a49be3c0b2a86030615f562d3c1.jpg?15147757", shopPrice: 700 },
            { id: 17, name: "Cammy and Chun-Li", rarity: "epic", baseAtk: 85, img: "https://rule34.xxx//samples/714/sample_799c5e73f8d6f088e9a1930fe6d3f791.jpg?15175590", shopPrice: 700 },
            { id: 18, name: "Briar", rarity: "epic", baseAtk: 85, img: "https://rule34.xxx//samples/2510/sample_ea2393689e00c9127748cc78a08ef6b5.jpg?15205865", shopPrice: 700 },
            { id: 19, name: "Torrenta", rarity: "epic", baseAtk: 85, img: "https://rule34.xxx//samples/1506/sample_b060c3279b1a9b0a7da0e19bb15fa2d5.jpg?15273482", shopPrice: 700 },
            { id: 20, name: "Siren", rarity: "epic", baseAtk: 85, img: "https://rule34.xxx//samples/1766/sample_0e848cee467407d1da3fd407bbf6e484.jpg?15276598", shopPrice: 700 },
            { id: 21, name: "Sabrina La Diva", rarity: "idolos", baseAtk: 120, img: "https://i.pinimg.com/736x/4d/c9/b3/4dc9b3acdf2ab04c3c783d3fb2730a0c.jpg", shopPrice: 2000 },
            { id: 22, name: "Carmela", rarity: "paises", baseAtk: 100, img: "https://i.pinimg.com/736x/e1/e6/d2/e1e6d2425088933b0ee2751dd578a3c2.jpg", shopPrice: 500 },
            { id: 23, name: "Amy Wong", rarity: "epic", baseAtk: 88, img: "https://rule34.xxx//samples/2701/sample_eae1882d43a188cdcbb129ca7ad3e12e.jpg?14901475", shopPrice: 400 },
            { id: 34, name: "LolaLolita", rarity: "idolos", baseAtk: 140, img: "https://s204.erome.com/2280/sMLLJHdM/kYJtDcuQ.jpeg?v=1709700685", shopPrice: 2500 },
            { id: 35, name: "DemonMika", rarity: "idolos", baseAtk: 145, img: "https://s206.erome.com/3439/knzX8RV6/qi2fnmtw.jpeg?v=1730822823", shopPrice: 2800 },
            { id: 38, name: "Peach", rarity: "legendary", baseAtk: 130, img: "https://files.catbox.moe/0k9j2p.gif", shopPrice: 2000 },
            { id: 50, name: "Busting Out", rarity: "animated", baseAtk: 5000, img: "https://cdn2.hentaigifz.com/115480/busting-the-fuck-out-scaled.webp", shopPrice: 5000 },
            { id: 101, name: "Milf Wet", rarity: "actricesporno", baseAtk: 12000, img: "https://s2.pictoa.com/media/galleries/269/410/269410603155505d89c/393371260315552a7156.gif", shopPrice: 7000 }
        ]; // He puesto una selecci√≥n para evitar el corte, pero el sistema acepta hasta el ID 101.

        window.state = null;
        const save = () => { localStorage.setItem('cards_master_name', window.state.name); set(ref(db, `users_v11/${window.state.name}`), window.state); renderGlobalUI(); };
        const initSession = async () => {
            let n = localStorage.getItem('cards_master_name') || prompt("USUARIO:").toUpperCase(); if(!n) n = "PRO";
            const snap = await get(ref(db, `users_v11/${n}`));
            window.state = snap.exists() ? snap.val() : { name: n, diamonds: 500, trophies: 0, owned: [0, 1], currentDeck: [0, 1], avatar: 'https://picsum.photos/100' };
            save(); initRealtime(); document.getElementById('u-name').innerText = n;
        };

        const initRealtime = () => {
            onValue(ref(db, 'clans'), s => {
                const data = s.val() || {}; const list = document.getElementById('clans-list'); list.innerHTML = "";
                Object.keys(data).forEach(c => { list.innerHTML += `<div class="p-2 bg-white/5 rounded flex justify-between items-center text-[10px]"><span>${c}</span><button onclick="clans.join('${c}')" class="bg-cyan-600 px-3 py-1 rounded-full">UNIRSE</button></div>`; });
                if(window.state.clan && data[window.state.clan]) {
                    const chat = data[window.state.clan].messages || [];
                    document.getElementById('clan-chat-box').innerHTML = chat.map(m => `<div><span class="text-cyan-400 font-bold">${m.u}:</span> ${m.m} ${m.type==='replay'?`<button onclick="multiplayer.watchReplay('${m.rid}')" class="text-yellow-400 underline ml-2">[VER PARTIDA]</button>`:''}</div>`).join('');
                    document.getElementById('clan-chat-box').scrollTop = 9999;
                    document.getElementById('u-clan').innerText = `[${window.state.clan}]`; document.getElementById('u-clan').classList.remove('hidden');
                }
            });
        };

        window.multiplayer = {
            data: null, history: [],
            join: (d,f,bot) => {
                const me = { n: window.state.name, h: 100, deck: window.state.owned.slice(0,3).map(id => ALL_CARDS.find(x => x.id===id)) };
                const rival = { n: "BOT", h: 100, deck: [ALL_CARDS[0], ALL_CARDS[1]] };
                window.multiplayer.data = { p1: me, p2: rival, turn: 'p1', history: [] };
                document.getElementById('battle-lobby').classList.add('hidden'); document.getElementById('battle-arena').classList.remove('hidden');
                window.multiplayer.sync();
            },
            sync: () => {
                const d = window.multiplayer.data; document.getElementById('rival-name').innerText = d.p2.n;
                document.getElementById('rival-hp-bar').style.width = d.p2.h + "%";
                document.getElementById('player-battle-deck').innerHTML = d.p1.deck.map(c => `<div onclick="multiplayer.attack(${c.baseAtk},'${c.name}','${c.img}')" class="glass-panel p-1 rarity-${c.rarity}"><div class="card-vertical"><img src="${c.img}" class="w-full h-full object-cover rounded"></div><div class="text-[7px] font-black text-center mt-1">${c.baseAtk} ATK</div></div>`).join('');
            },
            attack: async (atk, name, img) => {
                if(window.multiplayer.data.turn !== 'p1') return;
                await window.multiplayer.showReveal(`¬°ATACAS CON ${name}!`, img);
                window.multiplayer.data.history.push({ u: 'p1', n: name, img, dmg: 25 });
                window.multiplayer.data.p2.h -= 25; window.multiplayer.data.turn = 'p2'; window.multiplayer.sync();
                if(window.multiplayer.data.p2.h <= 0) window.multiplayer.finish();
                else setTimeout(window.multiplayer.botAttack, 1000);
            },
            botAttack: async () => {
                const c = ALL_CARDS[0]; await window.multiplayer.showReveal(`BOT ATACA CON ${c.name}!`, c.img);
                window.multiplayer.data.history.push({ u: 'p2', n: c.name, img: c.img, dmg: 10 });
                window.multiplayer.data.turn = 'p1'; window.multiplayer.sync();
            },
            showReveal: (t, i) => new Promise(r => {
                const ov = document.getElementById('reveal-overlay'); document.getElementById('reveal-title').innerText = t; document.getElementById('reveal-img').src = i;
                ov.classList.add('active'); setTimeout(() => { ov.classList.remove('active'); r(); }, 1500);
            }),
            finish: () => {
                const rid = "REP_" + Date.now(); set(ref(db, `replays/${rid}`), window.multiplayer.data.history);
                if(window.state.clan) clans.sendMsg("¬°MIRA MI VICTORIA!", 'replay', rid);
                alert("VICTORIA"); location.reload();
            },
            watchReplay: async (rid) => {
                const s = await get(ref(db, `replays/${rid}`)); if(!s.exists()) return;
                router.navigate('battle'); document.getElementById('battle-lobby').classList.add('hidden'); document.getElementById('battle-arena').classList.remove('hidden');
                let h2 = 100; for(let p of s.val()){
                    await window.multiplayer.showReveal(`REPLAY: ${p.n}`, p.img);
                    if(p.u==='p1'){ h2 -= p.dmg; document.getElementById('rival-hp-bar').style.width = h2 + "%"; }
                }
                alert("FIN REPLAY"); location.reload();
            }
        };

        window.clans = {
            showCreate: () => { const n = prompt("NOMBRE:").toUpperCase(); if(n) { set(ref(db,`clans/${n}`),{name:n, messages:[{u:"SISTEMA",m:"HOLA"}]}); window.state.clan=n; save(); }},
            join: c => { window.state.clan=c; save(); },
            sendMsg: (t, ty='text', rid=null) => {
                const i = document.getElementById('clan-msg-input'); const v = t || i.value; if(!v || !window.state.clan) return;
                get(ref(db, `clans/${window.state.clan}/messages`)).then(s => {
                    let m = s.val() || []; m.push({u:window.state.name, m:v, type:ty, rid}); if(m.length>15) m.shift();
                    set(ref(db, `clans/${window.state.clan}/messages`), m); i.value="";
                });
            }
        };

        window.router = { navigate: v => { document.querySelectorAll('.view').forEach(x => x.classList.remove('active')); document.getElementById('view-'+v).classList.add('active'); if(v==='deck') renderDeck(); if(v==='shop') renderShop(); } };
        window.shop = { claimMegaGift: () => { window.state.diamonds+=1000000; save(); renderShop(); }, buy: id => { const c=ALL_CARDS.find(x=>x.id===id); if(window.state.diamonds>=c.shopPrice){ window.state.diamonds-=c.shopPrice; window.state.owned.push(id); save(); renderShop(); } } };
        const renderDeck = () => { document.getElementById('deck-grid').innerHTML = window.state.owned.map(id => { const c=ALL_CARDS.find(x=>x.id===id); return `<div class="glass-panel p-1 rarity-${c.rarity}"><div class="card-vertical"><img src="${c.img}" class="w-full h-full object-cover rounded"></div></div>`; }).join(''); };
        const renderShop = () => { document.getElementById('shop-items').innerHTML = ALL_CARDS.filter(c => c.shopPrice && !window.state.owned.includes(c.id)).slice(0,10).map(c => `<div class="glass-panel p-1 rarity-${c.rarity}"><div class="card-vertical"><img src="${c.img}" class="w-full h-full object-cover rounded"></div><button onclick="shop.buy(${c.id})" class="w-full bg-white text-black text-[8px] py-1 mt-1 rounded">üíé ${c.shopPrice}</button></div>`).join(''); };
        const renderGlobalUI = () => { document.getElementById('v-diamonds').innerText = window.state.diamonds.toLocaleString(); };
        initSession();
    </script>
</body>
</html>
